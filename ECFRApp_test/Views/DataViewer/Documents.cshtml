@model List<ECFRApp_test.Models.ECFRDocument>
@{
    ViewData["Title"] = "All Documents";
}

<div class="container-fluid mt-4">
    <h1 class="mb-4">All ECFR Documents</h1>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger" role="alert">
            <strong>Error:</strong> @ViewBag.Error
        </div>
    }

    @if (Model.Any())
    {
        <div class="card mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h5>Total Documents: <span class="badge bg-primary">@Model.Count</span></h5>
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="filterInput" class="form-control" placeholder="Filter documents...">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="documentsTable">
                        <thead class="table-dark sticky-top">
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>Document Number</th>
                                <th>Title</th>
                                <th>Agency</th>
                                <th>Type</th>
                                <th>Citation</th>
                                <th>Publication Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.Count; i++)
                            {
                                var doc = Model[i];
                                <tr>
                                    <td>@(i + 1)</td>
                                    <td>@(doc.DocumentNumber ?? "-")</td>
                                    <td>@(doc.Title ?? "-")</td>
                                    <td>@(doc.AgencyName ?? "Unknown")</td>
                                    <td><span class="badge bg-info">@(doc.Type ?? "-")</span></td>
                                    <td><small>@(doc.Citation ?? "-")</small></td>
                                    <td>@(doc.PublicationDate?.ToString("MM/dd/yyyy") ?? "-")</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(doc.Url))
                                        {
                                            <a href="@doc.Url" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-link-45deg"></i> View
                                            </a>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No URL</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <h5>No Documents Available</h5>
            <p>Please fetch data from the <a href="@Url.Action("Index", "Dashboard")">Dashboard</a> first.</p>
        </div>
    }

    <div class="mt-3">
        <a href="@Url.Action("Index", "DataViewer")" class="btn btn-secondary">Back to Data Viewer</a>
        <a href="@Url.Action("Index", "Dashboard")" class="btn btn-outline-secondary">Dashboard</a>
    </div>
</div>

@section Scripts {
    <script>
        // Filter functionality
        document.getElementById('filterInput')?.addEventListener('input', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#documentsTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    </script>
}
